{% extends 'base/base2.html' %}
{% load static %}
{% load socialaccount %}

{% block content %}

        <div class="content-wrapper add-auto">
            <div class="container">
                <div class="content">
                    <h1 class="title">Выбрать бренд</h1>
                    {% csrf_token %}
                    <form action="{% url 'add_auto_page' %}" method="post" data-check-empty=true>
                        {{ addauto.vin_or_frame }}
                        <ol class="drop-down-wrapper" data-type-select="change">
                            {{ addauto.auto }}

                        </ol>
                        <ol class="drop-down-wrapper" data-type-select="change">
<!--                            Пока не выбрана марка, список моделей не показывается-->
                            {{ addauto.model }}

                        </ol>
                        <ol class="drop-down-wrapper" data-type-select="change">
<!--                            Пока не выбрана модель, список модификации не показывается-->
                            {{ addauto.modification }}

                        </ol>
                        {{ addauto.comment }}
                        <div class="add-auto-interface">
<!--                            Отмена - вернуться в гараж -->
                        <div class="btn red-btn">
                            <a href="{% url 'garage_page' %}">Отмена</a>
                        </div>
<!--                            Сохранить - добавить в гараж и вернуться в гараж -->
                            <button class="red-btn" type="submit" disabled>Сохранить</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

<script type="text/javascript">
    // Получаем элементы списков
    var autoSelect = document.getElementById('id_auto');
    var modelSelect = document.getElementById('id_model');
    var modificationSelect = document.getElementById('id_modification');

    //Функция проверки что все поля заполнены
    function checkEmpty() {
        var form = document.querySelector('form');
        if (form.checkValidity()) {
            form.submit();
        }
    }

    // Функция для загрузки данных по AJAX
    function loadData(url, callback) {
        var xhr = new XMLHttpRequest();
        xhr.onreadystatechange = function() {
            if (xhr.readyState === 4 && xhr.status === 200) {
                callback(xhr.responseText);
            }
        };
        xhr.open('GET', url, true);
        xhr.send();
    }

    // Назначаем обработчик события изменения выбора для списка автомобилей
    autoSelect.addEventListener('change', function() {
        var selectedAuto = this.value;
        // URL, откуда загружать данные
        var url = 'load_models/' + encodeURIComponent(selectedAuto);

        // Загружаем данные по AJAX
        loadData(url, function(response) {
            // Очищаем список моделей
            modelSelect.innerHTML = '';

            // Парсим полученный JSON-ответ
            var models = JSON.parse(response);

            // Добавляем полученные модели в список
            models.forEach(function(model) {
                var option = document.createElement('option');
                option.text = model[1];
                option.value = model[0];
                modelSelect.appendChild(option);
            });
        });
    });

    // Назначаем обработчик события изменения выбора для списка моделей
    modelSelect.addEventListener('change', function() {
        var selectedModel = this.value;
        // URL, откуда загружать данные
        var url = 'load_modifications/' + encodeURIComponent(selectedModel);

        // Загружаем данные по AJAX
        loadData(url, function(response) {
            // Очищаем список модификаций
            modificationSelect.innerHTML = '';

            // Парсим полученный JSON-ответ
            var modifications = JSON.parse(response);

            // Добавляем полученные модификации в список
            modifications.forEach(function(modification) {
                var option = document.createElement('option');
                option.text = modification[1];
                option.value = modification[0];
                modificationSelect.appendChild(option);
            });
        });
    });

</script>

{% endblock %}